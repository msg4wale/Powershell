# Step 0, use Start-Transcript to capture the execution to a text file and set variables for connecting to Azure Table

Start-Transcript -Path "C:\TempLogs\CVE-2021-36934Check-$(((get-date).ToUniversalTime()).ToString("yyyyMMddThhmmssZ")).log"



# Step 1, Restrict access and delete shadow copies

icacls $env:windir\system32\config\*.* /inheritance:e


$rest0 = Get-ComputerRestorePoint


if ($rest0){

    
    vssadmin delete shadows /for='C:' /Quiet

}

# Step 2, Check Restore point is deleted
$rest1 = Get-ComputerRestorePoint

if (!$rest1){

    
    Write-Host "Restore point Delete Successful"

}

# Step 3, Create new restore point

Checkpoint-Computer -Description "After CVE-2021-36934 Workaround" -RestorePointType "MODIFY_SETTINGS"

$rest2 = Get-ComputerRestorePoint

Write-Host $rest2

Stop-Transcript